<!DOCTYPE html>
<html lang="zh">
<head>
    <title>Jeopardy Game</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" type="text/css" href="style.css">
<!--    <script src="script.js"></script>-->
</head>
<body>
<div id="question-page">
    <h1>Jeopardy</h1>
    <h2 id="category-title"></h2>
    <div id="question"></div>
    <div id="choices"></div>
    <div id="timer" style="margin-top: 50px; font-size: 2rem">60</div>
    <div id="result"></div>
    <section style="display: flex; flex-direction: row; width: 60vw; justify-content: space-evenly;">
        <button id="button1" onclick="goBack()">返回主页面</button>
        <button id="remove-wrong-answer-button" onclick="removeWrongAnswer()">去掉一个错误答案</button>
    </section>

</div>
<script>
    // Define a global variable to store the loaded questions
    let questionsData;
    let countdown;

    // Load the JSON file
    function loadQuestions(callback) {
        const xhr = new XMLHttpRequest();
        xhr.overrideMimeType("application/json");
        xhr.open("GET", "Q&A.json", true);
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                const questions = JSON.parse(xhr.responseText);
                questionsData = questions; // Store the loaded questions in the global variable
                callback(questions);
            }
        };
        xhr.send(null);
    }

    // Use the loaded questions
    function useQuestions(questions) {
        const urlParams = new URLSearchParams(window.location.search);
        const category = urlParams.get("category");
        const questionNumber = parseInt(urlParams.get("question"));

        // Update the category title
        const categoryTitle = document.getElementById("category-title");
        categoryTitle.innerHTML = category;

        // Get the question and choices based on the category and question number
        const questionData = questions[category][questionNumber];
        const question = questionData.question;
        const choices = questionData.choices;

        // Display the question and choices
        const questionDiv = document.getElementById("question");
        questionDiv.innerHTML = question;

        const choicesDiv = document.getElementById("choices");
        choices.forEach((choice, index) => {
            const choiceButton = document.createElement("button");
            choiceButton.setAttribute("class", "choice-button");
            choiceButton.innerHTML = choice;
            choiceButton.addEventListener("click", () => checkAnswer(index, questionData));
            choicesDiv.appendChild(choiceButton);
        });

        // Countdown timer
        let timeLeft = 60;
        const timerDiv = document.getElementById("timer");

        countdown = setInterval(() => {
            if (timeLeft === 0) {
                clearInterval(countdown);
                checkAnswer(null, questionData);
            } else {
                timerDiv.innerHTML = timeLeft;
                timeLeft--;
            }
        }, 1000);
    }

    function checkAnswer(choiceIndex, questionData) {
        console.log("ALERT")
        clearInterval(countdown);

        const resultDiv = document.getElementById("result");
        if (choiceIndex === null) {
            resultDiv.innerHTML = "Time's up! You didn't answer the question.";
        } else {
            const isCorrect = choiceIndex === questionData.answer;
            if (isCorrect) {
                resultDiv.innerHTML = "Correct answer!";
                setTimeout(() => {
                    goBack();
                }, 2000);
            } else {
                resultDiv.innerHTML = "Wrong answer!";
            }
        }
    }

    function goBack() {
        window.location.href = "index.html";
    }

    // Load the questions and use them
    loadQuestions(useQuestions);

    function removeWrongAnswer() {
        const urlParams = new URLSearchParams(window.location.search);
        const category = urlParams.get('category');
        const questionNumber = parseInt(urlParams.get('question'));
        const choicesContainer = document.getElementById("choices");
        let buttons = choicesContainer.getElementsByClassName("choice-button");
        let wrongChoices = [];

        // Load the questions JSON file
        loadQuestions((questions) => {
            const questionData = questions[category][questionNumber];
            const answerIndex = questionData.answer;

            for (let i = 0; i < buttons.length; i++) {
                if (i !== answerIndex) {
                    wrongChoices.push(buttons[i]);
                }
            }

            if (wrongChoices.length > 0) {
                const randomIndex = Math.floor(Math.random() * wrongChoices.length);
                wrongChoices[randomIndex].style.color = "red";
            }
        });
    }


</script>
</body>
</html>